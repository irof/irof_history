def loc=this.getClass().getProtectionDomain().getCodeSource().getLocation()println "===start($loc)==="def prop1 = new Properties()prop1.load(new FileInputStream('local.properties'))def config = new ConfigSlurper().parse(prop1)def adb_home="${config.sdk.dir}//platform-tools"def apkName= "${config.release.app.name}_${config.release.app.version}.apk"println apkNamedef manifestXml = new XmlSlurper().parse(new File("AndroidManifest.xml"))//println manifestXml.dump()pkgName = manifestXml.@package.text()println pkgNamedef ant = new AntBuilder()println ant.dump()//read build.xmlimport org.apache.tools.ant.Projectimport org.apache.tools.ant.ProjectHelperdef antFile = new File("./build.xml")def project = new Project()project.init()ProjectHelper.configureProject(project, antFile);//project.executeTarget(project.defaultTarget);//project.executeTargets(['clean', 'release'] as Vector) //release-buildproject.executeTargets(['clean', 'debug'] as Vector) //release-build//see http://www.dzeta.jp/~junjis/code_reading/index.php?ant%2F%A5%D3%A5%EB%A5%C9%A5%D7%A5%ED%A5%BB%A5%B9%A4%F2%C6%C9%A4%E0//=== after-copy ==org_file = project.getProperty('out.final.file')to_file="./${project.getProperty('out.dir')}/../${apkName}"println "org_file=$org_file"ant.echo "to_file=$to_file"ant.copy(file:org_file,tofile:to_file,overwrite:true)//=== after-copy-install ==cmd=''ant.exec(outputproperty:"cmdOut",	errorproperty: "cmdErr",	resultproperty:"cmdExit",	failonerror: "false",	dir:".",	executable: "${adb_home}/adb"){		arg(line:"devices")	}println "[$cmd]<${ant.project.properties.cmdExit}>=${ant.project.properties.cmdOut}"	def deviceList = []def txt =ant.project.properties.cmdOutprintln txttxt.split('\n').each{	if(""== it.trim() || it=~/List*/ )return;//same continure	device = it.split('\t')[0]	println device	deviceList.add device}println deviceList.dump()cnt=1cmd=''deviceList.each{	cnt++	cmd ="-s $it uninstall $pkgName"	ant.exec(outputproperty:"cmdOut$cnt",		errorproperty: "cmdErr$cnt",		resultproperty:"cmdExit$cnt",		dir:".",		failonerror: "false",		executable: "${adb_home}/adb") {			arg(line:cmd)	}	println "[$cmd]<" + ant.project.properties."cmdExit$cnt" +">="+ ant.project.properties."cmdOut$cnt"	//println "stderr:         ${ant.project.properties.cmdErr2}"	cnt++	cmd = "-s $it install $apkName"	ant.exec(outputproperty:"cmdOut$cnt",		errorproperty: "cmdErr$cnt",		resultproperty:"cmdExit$cnt",		dir:".",		failonerror: "false",		executable: "${adb_home}/adb") {			arg(line:cmd)	}	println "[$cmd]<" + ant.project.properties."cmdExit$cnt" +">="+ ant.project.properties."cmdOut$cnt"	//println "stderr:         ${ant.project.properties.cmdErr3}"}println "===end($loc)==="